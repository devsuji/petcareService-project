/* 	임시 데이터 */
var data = [
    {
        "address_name": "서울 용산구 이태원동 728-2",
        "category_group_code": "CE7",
        "category_group_name": "카페",
        "category_name": "음식점 > 카페",
        "distance": "",
        "id": "2095380948",
        "phone": "02-792-3380",
        "place_name": "보마켓 경리단점",
        "place_url": "http://place.map.kakao.com/2095380948",
        "road_address_name": "서울 용산구 녹사평대로 286",
        "x": "126.989780002591",
        "y": "37.5421158259631"
    },
    {
        "address_name": "서울 용산구 이태원동 127-28",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 한식 > 육류,고기",
        "distance": "",
        "id": "1376253571",
        "phone": "02-793-2268",
        "place_name": "로우앤슬로우",
        "place_url": "http://place.map.kakao.com/1376253571",
        "road_address_name": "서울 용산구 보광로 126",
        "x": "126.99421849699539",
        "y": "37.53401162895581"
    },
    {
        "address_name": "서울 용산구 이태원동 181-8",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 양식 > 멕시칸,브라질",
        "distance": "",
        "id": "21535686",
        "phone": "02-797-8226",
        "place_name": "바토스 이태원점",
        "place_url": "http://place.map.kakao.com/21535686",
        "road_address_name": "서울 용산구 이태원로15길 1",
        "x": "126.990174761387",
        "y": "37.5346042203356"
    },
    {
        "address_name": "서울 용산구 이태원동 34-149",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 한식 > 국수",
        "distance": "",
        "id": "1952478679",
        "phone": "02-790-7300",
        "place_name": "명동교자 이태원점",
        "place_url": "http://place.map.kakao.com/1952478679",
        "road_address_name": "서울 용산구 녹사평대로 136",
        "x": "126.990949104616",
        "y": "37.5308561175718"
    },
    {
        "address_name": "서울 용산구 이태원동 79-44",
        "category_group_code": "CE7",
        "category_group_name": "카페",
        "category_name": "음식점 > 카페 > 커피전문점",
        "distance": "",
        "id": "1143868163",
        "phone": "02-790-4516",
        "place_name": "챔프커피 2작업실",
        "place_url": "http://place.map.kakao.com/1143868163",
        "road_address_name": "서울 용산구 녹사평대로26가길 24",
        "x": "126.992813433096",
        "y": "37.5324816520458"
    },
    {
        "address_name": "서울 용산구 이태원동 691",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 간식 > 제과,베이커리",
        "distance": "",
        "id": "18376376",
        "phone": "070-7717-3501",
        "place_name": "더베이커스테이블",
        "place_url": "http://place.map.kakao.com/18376376",
        "road_address_name": "서울 용산구 녹사평대로 244-1",
        "x": "126.987476649622",
        "y": "37.539447743498"
    },
    {
        "address_name": "서울 용산구 이태원동 258-7",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 양식 > 이탈리안",
        "distance": "",
        "id": "7849814",
        "phone": "02-794-6005",
        "place_name": "라쿠치나",
        "place_url": "http://place.map.kakao.com/7849814",
        "road_address_name": "서울 용산구 회나무로44길 10",
        "x": "126.99646969481634",
        "y": "37.54052955478657"
    },
    {
        "address_name": "서울 용산구 이태원동 449-1",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 양식 > 햄버거",
        "distance": "",
        "id": "654491255",
        "phone": "02-798-3456",
        "place_name": "롸카두들 내쉬빌핫치킨 이태원점",
        "place_url": "http://place.map.kakao.com/654491255",
        "road_address_name": "서울 용산구 녹사평대로40나길 9",
        "x": "126.9881144036468",
        "y": "37.53488514319734"
    },
    {
        "address_name": "서울 용산구 이태원동 172-2",
        "category_group_code": "CE7",
        "category_group_name": "카페",
        "category_name": "음식점 > 카페 > 테마카페 > 디저트카페",
        "distance": "",
        "id": "27462552",
        "phone": "02-795-7481",
        "place_name": "오리지널 팬케익하우스 이태원점",
        "place_url": "http://place.map.kakao.com/27462552",
        "road_address_name": "서울 용산구 이태원로 153",
        "x": "126.990989388798",
        "y": "37.5345538292542"
    },
    {
        "address_name": "서울 용산구 이태원동 129-9",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 양식 > 피자",
        "distance": "",
        "id": "26966268",
        "phone": "02-792-2420",
        "place_name": "매덕스피자",
        "place_url": "http://place.map.kakao.com/26966268",
        "road_address_name": "서울 용산구 이태원로26길 26",
        "x": "126.993537446114",
        "y": "37.5333430509277"
    },
    {
        "address_name": "서울 용산구 이태원동 131-23",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 패밀리레스토랑",
        "distance": "",
        "id": "26928254",
        "phone": "02-793-5072",
        "place_name": "꾸띠자르당",
        "place_url": "http://place.map.kakao.com/26928254",
        "road_address_name": "서울 용산구 보광로 120",
        "x": "126.994610005044",
        "y": "37.5334512248726"
    },
    {
        "address_name": "서울 용산구 이태원동 261-9",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 아시아음식 > 동남아음식",
        "distance": "",
        "id": "26425687",
        "phone": "070-4242-0426",
        "place_name": "레호이",
        "place_url": "http://place.map.kakao.com/26425687",
        "road_address_name": "서울 용산구 소월로38가길 5",
        "x": "126.990209837374",
        "y": "37.543243012875"
    },
    {
        "address_name": "서울 용산구 이태원동 73-7",
        "category_group_code": "CE7",
        "category_group_name": "카페",
        "category_name": "음식점 > 카페 > 테마카페 > 디저트카페",
        "distance": "",
        "id": "800587300",
        "phone": "",
        "place_name": "키에리 이태원점",
        "place_url": "http://place.map.kakao.com/800587300",
        "road_address_name": "서울 용산구 이태원로26길 16-8",
        "x": "126.993184448491",
        "y": "37.5333538430955"
    },
    {
        "address_name": "서울 용산구 이태원동 2-5",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 양식",
        "distance": "",
        "id": "618020526",
        "phone": "02-794-3234",
        "place_name": "로코스비비큐",
        "place_url": "http://place.map.kakao.com/618020526",
        "road_address_name": "서울 용산구 회나무로 83",
        "x": "126.995528253629",
        "y": "37.5409728148364"
    },
    {
        "address_name": "서울 용산구 이태원동 211-33",
        "category_group_code": "FD6",
        "category_group_name": "음식점",
        "category_name": "음식점 > 양식 > 이탈리안",
        "distance": "",
        "id": "26357129",
        "phone": "02-792-7775",
        "place_name": "비스테까 이태원본점",
        "place_url": "http://place.map.kakao.com/26357129",
        "road_address_name": "서울 용산구 회나무로 49",
        "x": "126.992138329245",
        "y": "37.5400788458841"
    }
];



// 마커를 담을 배열입니다
var markers = [];
var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
    };   
// 지도를 생성합니다    
var map = new kakao.maps.Map(mapContainer, mapOption);    

// 검색 결과 목록이나 마커를 클릭했을 때 장소명을 표출할 인포윈도우를 생성합니다
var infowindow = new kakao.maps.InfoWindow({zIndex:1});

displayPlaces(data);

// 검색 결과 목록과 마커를 표출하는 함수입니다
function displayPlaces(places) {
	console.log(places);
    //var listEl = document.getElementById('placesList'), 
    menuEl = document.getElementById('menu_wrap'),
    fragment = document.createDocumentFragment(), 
    bounds = new kakao.maps.LatLngBounds(), 
    listStr = '';
    
    // 검색 결과 목록에 추가된 항목들을 제거합니다
   // removeAllChildNods(listEl);

    // 지도에 표시되고 있는 마커를 제거합니다
    removeMarker();
    
    for ( var i=0; i<places.length; i++ ) {

        // 마커를 생성하고 지도에 표시합니다
        var placePosition = new kakao.maps.LatLng(places[i].y, places[i].x),
            marker = addMarker(placePosition, i); 
            //itemEl = getListItem(i, places[i]); // 검색 결과 항목 Element를 생성합니다

        // 검색된 장소 위치를 기준으로 지도 범위를 재설정하기위해
        // LatLngBounds 객체에 좌표를 추가합니다
        bounds.extend(placePosition);

        // 마커와 검색결과 항목에 mouseover 했을때
        // 해당 장소에 인포윈도우에 장소명을 표시합니다
        // mouseout 했을 때는 인포윈도우를 닫습니다
        (function(marker, title) {
            kakao.maps.event.addListener(marker, 'mouseover', function() {
                displayInfowindow(marker, title);
            });

            kakao.maps.event.addListener(marker, 'mouseout', function() {
                infowindow.close();
            });
            
            kakao.maps.event.addListener(marker, 'click', function() {
                displayOnClick(title);
            });

            //itemEl.onmouseover =  function () {
            //    displayInfowindow(marker, title);
            //};

            //itemEl.onmouseout =  function () {
            //    infowindow.close();
            //};
        })(marker, places[i].place_name);

        //fragment.appendChild(itemEl);
    }

    // 검색결과 항목들을 검색결과 목록 Elemnet에 추가합니다
    //listEl.appendChild(fragment);
    //menuEl.scrollTop = 0;

    // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
    map.setBounds(bounds);
}

// 마커를 생성하고 지도 위에 마커를 표시하는 함수입니다
function addMarker(position, idx, title) {
    var imageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png', // 마커 이미지 url, 스프라이트 이미지를 씁니다
        imageSize = new kakao.maps.Size(36, 37),  // 마커 이미지의 크기
        imgOptions =  {
            spriteSize : new kakao.maps.Size(36, 691), // 스프라이트 이미지의 크기
            spriteOrigin : new kakao.maps.Point(0, (idx*46)+10), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
            offset: new kakao.maps.Point(13, 37) // 마커 좌표에 일치시킬 이미지 내에서의 좌표
        },
        markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
            marker = new kakao.maps.Marker({
            position: position, // 마커의 위치
            image: markerImage 
        });

    marker.setMap(map); // 지도 위에 마커를 표출합니다
    markers.push(marker);  // 배열에 생성된 마커를 추가합니다

    return marker;
}

// 지도 위에 표시되고 있는 마커를 모두 제거합니다
function removeMarker() {	
    for ( var i = 0; i < markers.length; i++ ) {
        markers[i].setMap(null);
    }   
    markers = [];
}

// 검색결과 목록 또는 마커를 클릭했을 때 호출되는 함수입니다
// 인포윈도우에 장소명을 표시합니다
function displayInfowindow(marker, title) {
    var content = '<div style="padding:5px;z-index:1;">' + title + '</div>';

    infowindow.setContent(content);
    infowindow.open(map, marker);
}

// 마커 클릭했을때 이벤트
function displayOnClick(title) {
	alert(title);
	// 프로필 팝업호출
}

